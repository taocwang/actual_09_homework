<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="utf-8">
      <title>用户管理</title>
      <link rel="icon" href="/static/temp/favicon.ico">
      <link rel="stylesheet" href="{{url_for('static',filename='css/bootstrap.min.css')}}"  type="text/css" />
      <link rel="stylesheet" href="{{url_for('static',filename='css/main.css')}}"  type="text/css" />
      <link rel="stylesheet" href="{{url_for('static',filename='css/jquery.dataTables.css')}}"  type="text/css" />

<<<<<<< HEAD
=======
 <!--删除和退出动作，给予用户提示 -->
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
    <script type="text/javascript">
            function del(){
                if(!confirm("确认要删除？")){
                    window.event.returnValue = false;
                }

            }

           function logout(){
            if(!confirm("确定要退出？"))
            { window.event.returnValue = false; }
            }
        </script>
</head>
    <body>
<<<<<<< HEAD
=======

 <!--导航条-->
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">某某系统</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
          <li>
<<<<<<< HEAD
             {% if username %}
            <a>{{username}}欢迎回来！</a>
=======
             {% if curuser %}
            <a>{{curuser[0]['username']}}欢迎回来！</a>
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
            {% endif %}
            </li>
            <li>
            {% for msg in get_flashed_messages() %}
            <a>{{msg}}</a>
            {% endfor %}
            </li>
            <li><a href="/logout/">退出登录</a></li>
          </ul>
        </div>
      </div>
    </nav>
<<<<<<< HEAD
=======
<!--如果当前用户是管理员，页面主体，流式布局类2，适用于100%宽度，占据全部视口（viewport）的容器 -->
  {% if curuser[0]['username'] in ['admin'] %}
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
        <ul class="nav nav-sidebar">
           <li class="active"><a href="/users/">用户管理<span class="sr-only"></span></a></li>
           <li class="inactive"><a href="/user/create/" >添加用户<span class="sr-only"></span></a></li>
           <li class="inactive"><a href="/user/modifypasswd/" >修改密码<span class="sr-only"></span></a></li>
           <!--li class="inactive"><a href="/user/finduser/">查询用户<span class="sr-only"></span></a></li-->
           <li class="active"><a href="/user/logs/">日志查询<span class="sr-only"></span></a></li>
           <li class="active"><a href="/user/upload/">文件上传<span class="sr-only"></span></a> </li>
<<<<<<< HEAD

          </ul>
        </div>

        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <div class="container-fluid">

=======
          </ul>
        </div>
<!--如果当前用户是普通用户，页面主体，流式布局类2，适用于100%宽度，占据全部视口（viewport）的容器 -->
  {% else %}
     <div class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
        <ul class="nav nav-sidebar">
           <li class="active"><a href="/users/">用户管理<span class="sr-only"></span></a></li>
           <!--li class="inactive"><a href="/user/create/" >添加用户<span class="sr-only"></span></a></li-->
           <li class="inactive"><a href="/user/modifypasswd/" >修改密码<span class="sr-only"></span></a></li>
           <!--li class="inactive"><a href="/user/finduser/">查询用户<span class="sr-only"></span></a></li-->
           <li class="active"><a href="/user/logs/">日志查询<span class="sr-only"></span></a></li>
           <li class="active"><a href="/user/upload/">文件上传<span class="sr-only"></span></a> </li>
          </ul>
        </div>
    {% endif %}

  <!--偏移2列，主体内容部分 -->
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
  <!--页面主体-表格，流式布局类2，适用于100%宽度，占据全部视口（viewport）的容器 -->
        <div class="container-fluid">
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
            <table class="table table-striped table-bordered table-hover datatable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>用户名</th>
                        <th>密码</th>
                        <th>年龄</th>
<<<<<<< HEAD
                        <th colspan="3">操作</th>
                    </tr>
                </thead>
                <tbody>
=======
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
  <!--如果当前用户为管理员，则可以看到所有用户信息并修改 -->
                  {% if curuser[0]['username'] in ['admin'] %}
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
                    {% for user in users %}
                    <tr>
                        <td>{{user['id']}}</td>
                        <td>{{user['username']}}</td>
                        <td>{{user['password']}}</td>
                        <td>{{user['age']}}</td>
                        <td>
                        <!--a href="/user/modify/?id={{user['id']}}" class="btn btn-info" >更新</a-->
<<<<<<< HEAD
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#update-userinfo" data-password="{{user['password']}}" data-username="{{user['username']}}" data-age="{{user['age']}}" data-id="{{user['id']}}">更新</button></td>
                        <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#update-password" data-userid="{{user['id']}}" data-username="{{user['username']}}">修改密码</button></td>
                        <td><a href="/user/delete/?id={{user['id']}}" class="btn btn-danger" onclick="return del()">删除</a>
                        </td>
                    </tr>
                    {% endfor %}
=======
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#update-userinfo" data-password="{{user['password']}}" data-username="{{user['username']}}" data-age="{{user['age']}}" data-id="{{user['id']}}">修改</button>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#update-password" data-userid="{{user['id']}}" data-username="{{user['username']}}">修改密码</button>
                        <a href="/user/delete/?id={{user['id']}}" class="btn btn-danger" onclick="return del()">删除</a>
                        </td>
                    </tr>
                     {% endfor %}
  <!--如果当前用户为普通用户，则只能看到自己的信息并修改 -->
                        {% else %}
                        <tr>
                        <td>{{curuser[0]['id']}}</td>
                        <td>{{curuser[0]['username']}}</td>
                        <td>{{curuser[0]['password']}}</td>
                        <td>{{curuser[0]['age']}}</td>
                        <td>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#update-userinfo" data-password="{{curuser[0]['password']}}" data-username="{{curuser[0]['username']}}" data-age="{{curuser[0]['age']}}" data-id="{{curuser[0]['id']}}">修改</button>
                        <!--button type="button" class="btn btn-primary" data-toggle="modal" data-target="#update-password" data-userid="{{curuser[0]['id']}}" data-username="{{curuser[0]['username']}}">修改密码</button-->
                        <!--a href="/user/delete/?id={{id}}" class="btn btn-danger" onclick="return del()">删除</a-->
                        </td>
                    </tr>
                       {% endif %}

>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
                </tbody>
            </table>
        </div>  <!-- container-fluid -内部 -->
        </div>
<<<<<<< HEAD

=======
<!--管理员修改普通用户的密码 -->
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
    <div class="modal fade" id="update-password" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">修改密码</h4>
      </div>
      <div class="modal-body">
        <form>
              <input type="hidden" id="password-userid"/>
              <div class="form-group">
                <label for="password-username" class="control-label">用户名</label>
                <input type="text" class="form-control" id="password-username" readonly="readonly">
              </div>
              <div class="form-group">
                <label for="password-manager-password" class="control-label">管理员密码</label>
                <input type="password" class="form-control" id="password-manager-password">
              </div>
              <div class="form-group">
                <label for="password-user-password" class="control-label">用户密码</label>
                <input type="password" class="form-control" id="password-user-password">
              </div>
            </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" id="password-commit">更新密码</button>
      </div>
    </div>
    </div>
    </div>


<<<<<<< HEAD

=======
<!--用户信息修改框 -->
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
        <div class="modal fade" id="update-userinfo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">修改信息</h4>
      </div>
      <div class="modal-body">
        <form>
                <div class="form-group">

                <input type="hidden" class="form-control" id="user-id" readonly="readonly">
              </div>

              <div class="form-group">
                <label for="user-username" class="control-label">用户名</label>
                <input type="text" class="form-control" id="user-username" readonly="readonly">
              </div>
              <div class="form-group">
                <label for="user-password" class="control-label">密码</label>
                <input type="password" class="form-control" id="user-password" readonly="readonly">
              </div>
              <div class="form-group">
                <label for="user-age" class="control-label">年龄</label>
                <input type="text" class="form-control" id="user-age">
              </div>
            </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" id="update-commit">更新</button>
      </div>
    </div>
    </div>
    </div>
<<<<<<< HEAD
=======
    </div>
    </div>  <!-- container-fluid -->
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e


    <script type="text/javascript" src="{{url_for('static', filename='js/jquery-1.12.4.js')}}" ></script>
    <script type="text/javascript" src="{{url_for('static', filename='js/jquery-1.10.2.min.js')}}" ></script>
    <script type="text/javascript" src="{{url_for('static', filename='js/bootstrap.min.js')}}" ></script>
    <script type="text/javascript" src="{{url_for('static', filename='js/jquery.dataTables.js')}}" ></script>

<<<<<<< HEAD


    <script type="text/javascript">

=======
<!--触发修改密码事件后，进行密码修改 -->
    <script type="text/javascript">
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
     jQuery(document).ready(function() {
        jQuery('#update-password').on('show.bs.modal', function (event) {
       //show.bs.modal调用之后立即触发该事件。如果是通过点击某个作为触发器的元素，则此元素可以通过事件的 relatedTarget 属性进行访问。
        var button = jQuery(event.relatedTarget);  //触发button
        var username = button.data('username');   //通过button获取用户名
        var userid = button.data('userid');       //通过button获取用户id
        jQuery('#password-userid').val(userid);   //设置id=password-userid的值为从button获取的userid
        jQuery('#password-username').val(username); //设置id=password-username值为从button获取的username
              });

    jQuery('#password-commit').on('click', function(){
      //id为password-commit的控件触发后，执行操作
        var params = {};
        params['userid'] = jQuery('#password-userid').val();  //获取id=password-userid的值
        params['manager-password'] = jQuery('#password-manager-password').val(); //获取id=password-manager-password的值
        params['user-password'] = jQuery('#password-user-password').val(); //获取id=password-user-password的值
        console.log(params);  //控制台显示
        //通过ajax更新用户密码
        jQuery.post('/user/charge-password/',
            params,
            function(data) {
              if(data['is_ok']){
                alert('密码更新成功！');
                jQuery('#update-password').modal('hide');
                //window.location.replace('/users/');
                window.location.reload();
              } else {
                alert(data['error']);
              }
            },
            'json'
        );
    });
<<<<<<< HEAD

          });




=======
          });

    //触发修改用户信息事件后，进行用户信息修改
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
    //显示框框
     jQuery(document).ready(function() {
        jQuery('#update-userinfo').on('show.bs.modal', function (event) {
       //show.bs.modal调用之后立即触发该事件。如果是通过点击某个作为触发器的元素，则此元素可以通过事件的 relatedTarget 属性进行访问。
        var button = jQuery(event.relatedTarget);  //触发button
        var username = button.data('username');   //通过button获取用户名
        var password = button.data('password');       //通过button获取用户password
        var age = button.data('age');       //通过button获取用户age
        var id = button.data('id');
        jQuery('#user-username').val(username);   //设置id=user-username的值为从button获取的username
        jQuery('#user-password').val(password); //设置id=user-password值为从button获取的password
        jQuery('#user-age').val(age);
        jQuery('#user-id').val(id);
              });

    //点击提交动作
    jQuery('#update-commit').on('click', function(){
      //id为password-commit的控件触发后，执行操作
        var params = {};
        params['id'] = jQuery('#user-id').val(); //获取id=password-user-password的值
        params['username'] = jQuery('#user-username').val();  //获取id=password-userid的值
        params['password'] = jQuery('#user-password').val(); //获取id=password-manager-password的值
        params['age'] = jQuery('#user-age').val(); //获取id=password-user-password的值
        console.log(params);  //控制台显示
        //通过ajax更新用户密码
        jQuery.post('/user/update/',
            params,
            function(data) {
              if(data['is_ok']){
                alert('用户信息修改成功！');
                jQuery('#add-user').modal('hide');   //更新成功后，自动消失框框
                //window.location.replace('/users/');
                window.location.reload();
              } else {
                alert(data['error']);
              }
            },
            'json'
        );
    });

          });

    </script>

<<<<<<< HEAD
    </div>
    </div>  <!-- container-fluid -->
  </body>
</html>
    <style>
    body{
        margin-top: 20px;
    }
    </style>

    <script>
        $(document).ready(function() {
            $('.datatable').dataTable( );
            } );
=======
  </body>
</html>

 <!--设置表格和上面的距离-->
    <style>
    body{
        margin-top: 5px;
    }
    </style>

<!--汉化-->
    <script>
        $(document).ready(function() {
        $('.datatable').dataTable( {
        "language": {

        "sProcessing":   "处理中...",
        "sLengthMenu":   "_MENU_ 记录/页",
        "sZeroRecords":  "没有匹配的记录",
        "sInfo":         "显示第 _START_ 至 _END_ 项记录，共 _TOTAL_ 项",
        "sInfoEmpty":    "显示第 0 至 0 项记录，共 0 项",
        "sInfoFiltered": "(由 _MAX_ 项记录过滤)",
        "sInfoPostFix":  "",
        "sSearch":       "过滤:",
        "sUrl":          "",
        "oPaginate": {
            "sFirst":    "首页",
            "sPrevious": "上页",
            "sNext":     "下页",
            "sLast":     "末页"
        }

            }
        });
        } );
>>>>>>> f5947768a61fa20e516dfeeead8bd726e9c8250e
    </script>

<!-- Generated by RunJS (Fri Jun 17 17:40:32 CST 2016) 2ms -->
